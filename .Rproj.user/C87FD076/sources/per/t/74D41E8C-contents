library(testthat)

library(flexCountReg)

# Function to extract examples and create test files - If using dontrun or donttest
extract_examples_to_tests <- function(pkg_name) {
  pkg_path <- system.file(package = pkg_name)
  rd_files <- list.files(file.path(pkg_path, "man"), full.names = TRUE)
  
  for (rd_file in rd_files) {
    rd_name <- gsub("\\.Rd$", "", basename(rd_file))
    example_code <- tryCatch({
      capture.output(example(rd_name, package = pkg_name, run.dontrun = TRUE, run.donttest = TRUE))
    }, error = function(e) NULL)
    
    if (!is.null(example_code)) {
      test_code <- paste0(
        "test_that('Examples for ", rd_name, "', {\n",
        paste("  ", example_code, collapse = "\n"),
        "\n})\n"
      )
      
      # Save the test code to a test file
      test_file_path <- file.path("tests/testthat", paste0("test-", rd_name, ".R"))
      writeLines(test_code, con = test_file_path)
    }
  }
}


# Function to extract examples from Rd files and create test files otherwise
extract_examples_to_tests2 <- function(pkg_path) {
  rd_files <- list.files(file.path(pkg_path, "man"), full.names = TRUE)
  
  for (rd_file in rd_files) {
    rd_name <- gsub("\\.Rd$", "", basename(rd_file))
    rd_content <- tools::parse_Rd(rd_file)
    
    examples <- tools::Rd2ex(rd_content)
    
    if (nchar(examples) > 0) {
      test_code <- paste0(
        "test_that('Examples for ", rd_name, "', {\n",
        examples,
        "\n})\n"
      )
      
      # Save the test code to a test file
      test_file_path <- file.path(pkg_path, "tests/testthat", paste0("test-", rd_name, ".R"))
      writeLines(test_code, con = test_file_path)
    }
  }
}

library(flexCountReg)
# Extract examples and create test files for your package
extract_examples_to_tests("flexCountReg")
extract_examples_to_tests2("C:/Users/jwood2/Documents/flexCountReg_edit")

# Run the tests
test_check("flexCountReg")
